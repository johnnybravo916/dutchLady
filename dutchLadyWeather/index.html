<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DutchLady</title>
    <link  rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    
  </head>
  <body>
    <div class="container">
        <div class="row">
           
            <div class="col-sm-12">
                <h2>Dutch Lady Weather</h2>
                <h3 id="current"></h3>
                <input id="latlng" type="hidden" value="">
            </div>

        </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./dist/weather.js"></script>
    <script>
        /**
         * Utilizes openweather API to get current weather by providing the city name. 
         * @param  {str} location 
         * @return HTML - string of current weather and weather icon
         */
        function getWeather(location) {
            Weather.getCurrent( location, function( current ) {
                $( "#current" ).html( "Weather: " + current.temperature() + "&deg;K or " +
                    Weather.kelvinToFahrenheit( current.temperature() ) + "&deg;F or " +
                    Weather.kelvinToCelsius( current.temperature() ) + "&deg;C" +
                    Weather.getIcon(current.icon()));
            });
        }

        /**
         * Get Location uses google maps api to get the city name that is needed by the weather API
         * @param  {str} lat 
         * @param  {str} long 
         * @return function call to getWeather
         */
        function getLocation(lat,long) {
          var geocoder = new google.maps.Geocoder;
          var input = document.getElementById('latlng').value;
          var latlngStr = input.split(',', 2);
          var latlng = {lat: parseFloat(lat), lng: parseFloat(long)};
          geocoder.geocode({'location': latlng}, function(results, status) {
            if (status === 'OK') {
              if (results[1]) {
                console.log(results[1].address_components);

                getWeather(results[1].address_components[2].long_name);
              } else {
                window.alert('No results found');
              }
            } else {
              window.alert('Geocoder failed due to: ' + status);
            }
          });
        }

        // TODO:: Create a condition. If local storage is not empty, get latlong. Else, store.        
        /**
         * This function gets the geolocation based on ID
         * @return {str lat and long} - will then pass the variables to getLocation method
         */
        function getIP() {
            $.getJSON('https://geoip-db.com/json/geoip.php?jsonp=?') 
            .done (function(location)
            {
                var lat = location.latitude;
                var long = location.longitude;
                console.log("Geolocation:: " + lat, long);

                getLocation(lat, long);
            });
        }
    </script>
   
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBG1A6k-kQiIbmANhdSTGcRjV2dI5bXlgs&callback=getIP"></script>
  </body>
</html>